{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MAMA's Kitchen – Fresh, Fast, Delicious</title>
  <meta name="description" content="E‑commerce homepage for a stylish cloud kitchen with menus, dishes, and cart." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Lucide icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    :root { --brand: #16a34a; --brand-600: #16a34a; --brand-700:#15803d; }
    html, body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, 'Apple Color Emoji', 'Segoe UI Emoji'; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    .fade-in { animation: fade .6s ease both; }
    @keyframes fade { from { opacity: 0; transform: translateY(6px) } to { opacity: 1; transform: none } }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- Announcement Bar -->
  <div class="w-full bg-gradient-to-r from-emerald-600 via-emerald-500 to-emerald-600 text-white text-sm">
    <div class="max-w-7xl mx-auto px-4 py-2 flex items-center gap-2 justify-center">
      <span class="inline-flex items-center gap-1 font-semibold"><i data-lucide="bike" class="w-4 h-4"></i> 30‑min delivery</span>
      <span class="opacity-80">·</span>
      <span>Use code <b>TASTY100</b> for ₹100 off above ₹599</span>
    </div>
  </div>

  <!-- Header -->
  <header class="sticky top-0 z-50 backdrop-blur bg-white/75 border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center gap-4">
      <a href="#" class="flex items-center gap-2 group">
        <div class="w-9 h-9 rounded-2xl bg-gradient-to-br from-emerald-500 to-lime-500 grid place-items-center text-white shadow-md">
          <i data-lucide="chef-hat" class="w-5 h-5"></i>
        </div>
        <div>
          <div class="text-lg font-extrabold tracking-tight">MAMA's Kitchen</div>
          <div class="text-[11px] -mt-1 text-gray-500">Fresh · Fast · Delicious</div>
        </div>
      </a>
      <div class="hidden md:flex flex-1 items-center">
        <div class="relative w-full max-w-xl">
          <input id="search" type="text" placeholder="Search dishes, cuisines, or ingredients…" class="w-full rounded-2xl border border-gray-300 bg-white/80 focus:bg-white px-11 py-2.5 text-[15px] outline-none focus:ring-2 focus:ring-emerald-500" />
          <i data-lucide="search" class="w-5 h-5 absolute left-3 top-2.5 text-gray-500"></i>
        </div>
      </div>
      <nav class="ml-auto hidden sm:flex items-center gap-3">
        <button id="btn-login" class="px-4 py-2 rounded-xl border border-gray-300 hover:border-gray-400 text-sm">Log in</button>
        <button id="btn-signup" class="px-4 py-2 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white text-sm shadow">Sign up</button>
        <button id="btn-cart" class="relative p-2 rounded-xl hover:bg-gray-100">
          <i data-lucide="shopping-bag" class="w-6 h-6"></i>
          <span id="cart-count" class="absolute -right-1 -top-1 text-[11px] bg-emerald-600 text-white rounded-full w-5 h-5 grid place-items-center">0</span>
        </button>
      </nav>
      <button id="btn-cart-mobile" class="sm:hidden ml-auto relative p-2 rounded-xl hover:bg-gray-100">
        <i data-lucide="shopping-bag" class="w-6 h-6"></i>
        <span id="cart-count-mobile" class="absolute -right-1 -top-1 text-[11px] bg-emerald-600 text-white rounded-full w-5 h-5 grid place-items-center">0</span>
      </button>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="relative overflow-hidden">
    <div class="max-w-7xl mx-auto px-4 grid md:grid-cols-2 gap-10 items-center py-10 md:py-16">
      <div class="order-2 md:order-1">
        <h1 class="text-3xl md:text-5xl font-extrabold leading-tight tracking-tight">
          Restaurant‑quality meals,<br class="hidden md:block" /> delivered in <span class="text-emerald-600">30 minutes</span>.
        </h1>
        <p class="mt-4 text-gray-600 max-w-prose">Build your perfect bowl, crave‑worthy biryani, sizzling pan‑pizzas, and fresh salads — all crafted in our MAMA's kitchen and delivered hot.</p>
        <div class="mt-6 flex flex-wrap gap-3">
          <a href="#menu" class="px-5 py-3 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white font-medium shadow">Order now</a>
          <button id="btn-explore" class="px-5 py-3 rounded-xl border border-gray-300 hover:border-gray-400 font-medium">Explore menu</button>
        </div>
        <div class="mt-6 flex items-center gap-6 text-sm text-gray-600">
          <div class="flex items-center gap-2"><i data-lucide="leaf" class="w-4 h-4 text-emerald-600"></i> Farm‑fresh ingredients</div>
          <div class="flex items-center gap-2"><i data-lucide="shield" class="w-4 h-4 text-emerald-600"></i> FSSAI Certified</div>
        </div>
      </div>
      <div class="order-1 md:order-2 relative">
        <img alt="Hero Food" class="w-full h-72 md:h-[420px] object-cover rounded-3xl shadow-xl" src="https://images.pexels.com/photos/9161031/pexels-photo-9161031.jpeg" />
      </div>
    </div>
  </section>

  <!-- Categories Chips -->
  <section class="max-w-7xl mx-auto px-4 mt-6">
    <div class="flex gap-3 overflow-x-auto no-scrollbar pb-2">
      <button class="chip active" data-filter="all">All</button>
      {% for item in category %}
        <button class="chip" data-filter="{{ item.slug }}">{{ item.name }}</button>
      {% endfor %}
    </div>
  </section>

  <!-- Menu Grid -->
  <section id="menu" class="max-w-7xl mx-auto px-4 mt-10">
    <div class="flex items-baseline justify-between">
      <h2 class="text-xl md:text-2xl font-bold">Menu Highlights</h2>
      <button id="clear-cart" class="text-sm text-emerald-700 hover:underline">Clear cart</button>
    </div>
    <div id="menu-grid" class="grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mt-4"></div>
  </section>

  <!-- Cart Drawer -->
  <div id="cart-drawer" class="fixed inset-y-0 right-0 w-full max-w-md bg-white shadow-2xl border-l border-gray-200 translate-x-full transition-transform duration-300 z-[60] flex flex-col">
    <div class="p-4 border-b flex items-center justify-between">
      <div class="font-bold text-lg">Your Cart</div>
      <button id="close-cart" class="p-2 rounded-lg hover:bg-gray-100"><i data-lucide="x" class="w-5 h-5"></i></button>
    </div>
    <div id="cart-items" class="p-4 flex-1 overflow-y-auto"></div>
    <div class="p-4 border-t space-y-2">
      <div class="flex justify-between text-sm"><span>Subtotal</span><span id="subtotal">₹0</span></div>
      <div class="flex justify-between text-sm"><span>Delivery</span><span id="delivery">₹39</span></div>
      <div class="flex justify-between text-base font-bold"><span>Total</span><span id="total">₹39</span></div>
      <button id="checkout" class="w-full mt-2 bg-emerald-600 hover:bg-emerald-700 text-white py-3 rounded-xl font-semibold">Checkout</button>
    </div>
  </div>
  <div id="cart-backdrop" class="fixed inset-0 bg-black/40 backdrop-blur-[1px] hidden z-50"></div>

  <!-- JS -->
  <script>
    const PRODUCTS = [
      {% for product in productview %}
      { id: '{{ product.slug }}', name: '{{ product.name }}', price: {{ product.price }}, tag: '{{ product.category.slug }}', img: '{{ product.image.url }}' }{% if not forloop.last %},{% endif %}
      {% endfor %}
    ];

    let state = { cart: {}, filter: 'all', sort: 'popular', query: '' };

    function fmt(n){ return `₹${n}`; }

    function renderProducts() {
      let items = PRODUCTS.filter(p => state.filter === 'all' || p.tag === state.filter);
      if (state.query) items = items.filter(p => p.name.toLowerCase().includes(state.query.toLowerCase()));
      if (state.sort === 'price-asc') items.sort((a,b)=>a.price-b.price);
      if (state.sort === 'price-desc') items.sort((a,b)=>b.price-a.price);
      document.getElementById('menu-grid').innerHTML = items.map(p=>`
        <div class="group bg-white rounded-2xl border border-gray-200 overflow-hidden shadow-sm hover:shadow-md transition fade-in">
          <div class="relative"><img alt="${p.name}" class="h-44 w-full object-cover" src="${p.img}"/></div>
          <div class="p-4">
            <div class="font-semibold leading-snug">${p.name}</div>
            <div class="mt-1 text-sm text-gray-500 capitalize">${p.tag}</div>
            <div class="mt-3 flex items-center justify-between">
              <div class="text-lg font-bold">${fmt(p.price)}</div>
              <button class="add-btn px-3 py-2 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white text-sm" data-id="${p.id}">Add</button>
            </div>
          </div>
        </div>`).join('');
      attachAddButtons();
      lucide.createIcons();
    }

    function attachAddButtons(){
      document.querySelectorAll('.add-btn').forEach(btn=>{
        btn.addEventListener('click',()=>addToCart(btn.dataset.id));
      });
    }

    function addToCart(id){
      const p = PRODUCTS.find(x=>x.id===id);
      if (!state.cart[id]) state.cart[id]={ product: p, qty: 0 };
      state.cart[id].qty++;
      updateCartUI();
    }

    function updateQty(id, qty){
      if(qty<=0) delete state.cart[id]; else state.cart[id].qty=qty;
      updateCartUI();
    }

    function removeFromCart(id){ delete state.cart[id]; updateCartUI(); }

    function cartTotals(){
      const subtotal = Object.values(state.cart).reduce((s,{product,qty})=>s+product.price*qty,0);
      const delivery = subtotal>0?39:0;
      return { subtotal, delivery, total: subtotal+delivery };
    }

    function updateCartUI(){
      const itemsEl = document.getElementById('cart-items');
      const count = Object.values(state.cart).reduce((s,x)=>s+x.qty,0);
      document.getElementById('cart-count').textContent=count;
      document.getElementById('cart-count-mobile').textContent=count;

      if(count===0){ itemsEl.innerHTML=`<div class="text-center text-gray-500 py-16"><i data-lucide="shopping-bag" class="w-8 h-8 mx-auto mb-2"></i>Your cart is empty</div>`; }
      else{
        itemsEl.innerHTML=Object.values(state.cart).map(({product,qty})=>`
          <div class="flex gap-3 py-3 border-b">
            <img class="w-16 h-16 rounded-lg object-cover" src="${product.img}" alt="${product.name}">
            <div class="flex-1">
              <div class="font-semibold">${product.name}</div>
              <div class="text-sm text-gray-500">${product.tag}</div>
              <div class="mt-2 flex items-center gap-2">
                <button class="p-2 rounded-lg border" onclick="updateQty('${product.id}', ${qty-1})"><i data-lucide="minus" class="w-4 h-4"></i></button>
                <span class="min-w-[2ch] text-center">${qty}</span>
                <button class="p-2 rounded-lg border" onclick="updateQty('${product.id}', ${qty+1})"><i data-lucide="plus" class="w-4 h-4"></i></button>
                <button class="ml-auto p-2 rounded-lg hover:bg-gray-100" onclick="removeFromCart('${product.id}')"><i data-lucide="trash" class="w-4 h-4"></i></button>
              </div>
            </div>
            <div class="font-semibold">${fmt(product.price*qty)}</div>
          </div>`).join('');
      }

      const {subtotal, delivery, total} = cartTotals();
      document.getElementById('subtotal').textContent=fmt(subtotal);
      document.getElementById('delivery').textContent=fmt(delivery);
      document.getElementById('total').textContent=fmt(total);
      lucide.createIcons();
    }

    document.querySelectorAll('.chip').forEach(chip=>{
      chip.classList.add('px-4','py-2','rounded-full','border','border-gray-300','bg-white','text-sm','hover:border-gray-400','whitespace-nowrap');
      chip.addEventListener('click',()=>{
        document.querySelectorAll('.chip').forEach(c=>c.classList.remove('ring-2','ring-emerald-500','border-emerald-500'));
        chip.classList.add('ring-2','ring-emerald-500','border-emerald-500');
        state.filter = chip.dataset.filter;
        renderProducts();
      });
    });

    document.getElementById('sort')?.addEventListener('change', e=>{ state.sort=e.target.value; renderProducts(); });
    document.getElementById('search')?.addEventListener('input', e=>{ state.query=e.target.value; renderProducts(); });

    const drawer=document.getElementById('cart-drawer');
    const backdrop=document.getElementById('cart-backdrop');
    document.getElementById('btn-cart').addEventListener('click',()=>{ drawer.classList.remove('translate-x-full'); backdrop.classList.remove('hidden'); });
    document.getElementById('btn-cart-mobile').addEventListener('click',()=>{ drawer.classList.remove('translate-x-full'); backdrop.classList.remove('hidden'); });
    document.getElementById('close-cart').addEventListener('click',()=>{ drawer.classList.add('translate-x-full'); backdrop.classList.add('hidden'); });
    backdrop.addEventListener('click',()=>{ drawer.classList.add('translate-x-full'); backdrop.classList.add('hidden'); });
    document.getElementById('clear-cart').addEventListener('click',()=>{ state.cart={}; updateCartUI(); });
    document.getElementById('checkout').addEventListener('click',()=>{ alert('Checkout flow not implemented.'); });
    document.getElementById('btn-explore').addEventListener('click',()=>{ document.getElementById('menu').scrollIntoView({behavior:'smooth'}); });

    document.getElementById('year').textContent=new Date().getFullYear();
    renderProducts();
    updateCartUI();
    lucide.createIcons();
  </script>

</body>
</html>
